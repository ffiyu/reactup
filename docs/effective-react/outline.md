# 组件函数

## 组件应该是纯函数

- 解释组件函数：执行该函数会运行到的代码。
- 解释纯函数。
- 相同的 props 和 state 应该返回相同的 UI。
- 变化路径无关。
- 什么是副作用。
- 副作用不要写在组件函数内，应该在 useEffect 里。
- 不要依赖组件函数被执行的次数（StrictMode）。

## 关注组件函数的性能

- 要有预期，你的组件函数会被频繁执行，可能 1s 内会执行数次。
- 虽然 react fiber reconciler 支持支持异步可中断的渲染，不会阻塞用户交互，但还是组件本身的渲染会有明显延迟，用户也会感知到性能问题。
- JS 引擎的性能还是可以承受一些数量级不大的运算的。
- 一些改善性能的操作：
  - 函数作为 stateInitial
  - 常量外移
  - useMemo
  - 繁重计算转异步并 fallback UI
  - 这里不展开 memo（memo 在于降低组件函数执行的次数，这里侧重降低单次执行的时间）

## 保持组件函数简洁

### 使用 renderXxx 函数整合代码

- 逻辑清晰
- 避免横向地狱
- 利于拆分组件

### 利用函数、自定义 hook 整合逻辑

- 代码结构更清晰
- 方便复用

### 组件拆分

#### 主干+小组件

- 组件编写时，逐个击破，比一下子写一个复杂的大组件简单。
- 问题定位时，能具体到对应的小组件，而不是在一个大组件中。

#### 无状态组件（受控组件）
